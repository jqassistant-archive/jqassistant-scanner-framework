<jqassistant-rules xmlns="http://schema.jqassistant.org/rule/v1.10">
    <group id="typescript">
        <includeConcept refId="typescript:*"/>
    </group>
    <group id="debug">
        <includeConcept refId="debug:*"/>
    </group>

    <concept id="typescript:AllChildren">
        <cypher><![CDATA[
            MATCH
                (program:Program)-[*..256]->(child)
            CALL apoc.path.spanningTree(program, {labelFilter: '+Program'})
            YIELD path
            MERGE
                (program)-[:CHILD_OF_PROGRAM]->(child)
            RETURN *
            ]]>
        </cypher>
    </concept>
    <concept id="debug:temp">
        <cypher><![CDATA[
            MATCH
                (x)-[childRelationship:CHILD_OF_PROGRAM]->(y)
            DELETE childRelationship
            ]]>
        </cypher>
    </concept>

    <concept id="typescript:ExportDeclaration">
        <cypher><![CDATA[
            MATCH
                (program:Program)-[:HAS_SOURCE_ELEMENTS]->
                (sourceElement:SourceElement)-[:HAS_SOURCE_ELEMENT]->
                ()-[:HAS_EXPORT]->
                (identifier:TerminalNodeStrings)
            MATCH
                (sourceElement)-[:HAS_INTERFACE_DECLARATION]->
                ()-[:HAS_OBJECT_TYPE]->
                (objectType:ObjectType)
            MERGE
                (type:TypeScript:Language:Type {
                    name: identifier.text,
                    fqn:  "identifierName.sourceCode",
                    sourceCode:  sourceElement.sourceCode
                })
            MERGE
                (program)-[:EXPORTS]->(type)
            RETURN *
            ]]>
        </cypher>
    </concept>

    <concept id="typescript:SingleImportDeclaration">
        <cypher><![CDATA[
            MATCH
                (program:Program)-[:HAS_SOURCE_ELEMENTS]->
                ()-[:HAS_SOURCE_ELEMENT]->
                ()-[:HAS_STATEMENT]->
                ()-[:HAS_IMPORT_STATEMENT]->
                ()-[:HAS_FROM_BLOCK]->
                ()-[:HAS_MULTIPLE_IMPORT_STATEMENT]->
                ()-[:HAS_IDENTIFIER_NAME]->
                (identifierName:IdentifierName)-[:HAS_IDENTIFIER]->
                (identifier:TerminalNodeStrings)
            MERGE
                (type:TypeScript:Language:Type {
                    name: identifier.text,
                    fqn:  "identifierName.sourceCode"
                })
            MERGE
                (program)-[:IMPORTS {alias: "alias"}]->(type)
            RETURN *
            ]]>
        </cypher>
    </concept>


</jqassistant-rules>
